define(["jquery","atto_subtitle/constants"],function(a,b){return{controls:{},activeSubtitle:-1,ss:null,mediatype:b.mediatype_video,init:function(a,b){this.ss=a,this.mediatype=b,this.initControls(),this.initEvents()},initControls:function(){this.controls.videoplayer=a(b.videoplayer),this.controls.audioplayer=a(b.audioplayer),this.controls.root=a(b.root),this.mediatype===b.mediatype_audio?this.controls.mediaplayer=this.controls.audioplayer:this.controls.mediaplayer=this.controls.videoplayer,this.controls.mediaplayer.show(),this.controls.previewline=a(b.previewline)},initEvents:function(){var a=this;this.controls.mediaplayer.on("timeupdate",function(b){var c=a.fetchCurrentTime(),d=a.ss.fetchItemByTime(c);d===!1?a.deactivateAll():a.activeSubtitle!==d&&a.activateSubtitle(d)})},setPosition:function(a){var b=this.ss.fetchItem(a);if(b){this.controls.mediaplayer[0].pause();var c=(b.start/1e3).toFixed(3);this.controls.mediaplayer[0].currentTime=c}},updateLabel:function(){this.activeSubtitle>-1&&this.activateSubtitle(this.activeSubtitle)},fetchCurrentTime:function(){return Math.floor(1e3*this.controls.mediaplayer[0].currentTime)},setMediaURL:function(a){if(!(!a|""==a.trim())){switch(this.mediatype){case b.mediatype_audio:this.mediatype=b.mediatype_audio,this.controls.mediaplayer.off("timeupdate"),this.controls.mediaplayer=this.controls.audioplayer,this.initEvents(),this.controls.root.addClass("player-audio");break;default:this.mediatype=b.mediatype_video,this.controls.mediaplayer.off("timeupdate"),this.controls.mediaplayer=this.controls.videoplayer,this.initEvents(),this.controls.root.removeClass("player-audio")}this.controls.mediaplayer.attr("src",a),this.controls.mediaplayer[0].load()}},activateSubtitle:function(a){this.highlightItem(a),this.activeSubtitle=a;var b=this.ss.fetchItem(a);b?(this.controls.previewline.text(b.part),this.controls.previewline.show()):this.deactivateAll()},deactivateAll:function(){this.deHighlightAll(),this.activeSubtitle=-1,this.controls.previewline.text("")},highlightItem:function(a){},deHighlightAll:function(){}}});